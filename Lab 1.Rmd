---
title: "52414 - lab 1"
author: "52414"
date: "10/5/2023"
output: html_document
---

```{r}
library(tidyverse) # This includes dplyr, stringr, ggplot2, .. 
library(data.table)
library(rworldmap) # world map
library(ggthemes)
library(reshape2) # melt: change data-frame format long/wide
library(e1071) # skewness and kurtosis
library(rvest)
library(corrplot)
library(moments)
library(spatstat.geom)

```

**Solution:** (Fill code, text, plots etc.)

# 1.a. Loading the data via URL connection:

```{r, cache=TRUE}
democracy <- read_html("https://en.wikipedia.org/wiki/Democracy_Index")
all.tables = html_nodes(democracy, "table")  
regions <- as.data.frame(html_table(all.tables[4], fill = TRUE))
countries <- as.data.frame(html_table(all.tables[6], fill = TRUE))
components <- as.data.frame(html_table(all.tables[7], fill = TRUE))
```

# 1.b.

```{r, cache=TRUE}
countries_rate <- as.data.frame(countries)
top_countries <- countries_rate %>% select(Country, X2022) %>% arrange(desc(X2022)) %>% head(5)
bottom_countries <- countries_rate %>% select(Country, X2022) %>% arrange(X2022) %>% head(5)
Average <- rowMeans(countries_rate %>% select(-c(Region,X2022.rank,Country, Regime.type)))
top_countries_avg <- countries_rate %>% mutate(Average) %>% select(Country,Average) %>% arrange(desc(Average)) %>% head(5)
bottom_countries_avg <- countries_rate %>% mutate(Average) %>% select(Country, Average) %>% arrange(Average) %>% head(5)
```

YOUR ANALYSIS HERE:

Top countries in democracy index for 2022:

```{r}
top_countries
```

By 2006 -2022 Average:

```{r}
top_countries_avg
```

Lowest countries in democracy index for 2022:

```{r}
bottom_countries
```

By 2006 -2022 Average:

```{r}
bottom_countries_avg
```

# 2.a.

```{r, cache=TRUE}
p2 <- ggplot(countries)
p2 <- p2 + geom_boxplot(aes(x=Region, y=X2022)) +theme(text = element_text(size = 6))
p3 <- countries %>% select(Country,Region,X2022) %>% filter(Region == "Middle East and North Africa")
p4 <- countries %>% select(Country,Region,X2022) %>% filter(Region == "Western Europe")
out_3 <- boxplot.stats(p3$X2022)$out
out_ind_3 <- which(p3$X2022 %in% c(out_3))
out_4 <- boxplot.stats(p4$X2022)$out
out_ind_4 <- which(p4$X2022 %in% c(out_4))
p3[out_ind_3,]
p4[out_ind_4,]

```


2.b.

```{r, cache=TRUE}
p5 <- ggplot(countries,aes(X2022)) + geom_density(alpha=.2, fill= "#00BFC4") + facet_wrap(~Region)
p6 <- countries %>% 
     group_by(Region) %>%
     summarize(Mean = mean(X2022), Variance = var(X2022), Skewness = skewness(X2022), Kurtosis = kurtosis(X2022))
```

YOUR ANALYSIS HERE

3.a.

```{r, cache=TRUE}
Countries_graphs <- function(df, names){
  colnames <- colnames(df)
  if (sum(is.element(names, df$Region)) > 0) { x <- "Region" }
  else x <- "Country"
  
  y <-melt(df, id.vars = x)
  
  if (x == "Region"){
    print("this is regions")
    y <- y %>% filter(Region %in% names)
    print(y , "after filtering")
    y <- y%>%  mutate(year = as.Date(as.character(ISOdate(as.numeric(gsub('X', '', variable)),12,31)))) %>% 
    filter(! year< "2006-12-31") %>% mutate(val = as.double(value))
    print(y)
    ggplot(y, aes(x = year, y =val)) + geom_line(aes(color = Region)) + labs(title="Democracy", 
         subtitle="Between the years 2006-2022",
         caption="Source: Wikipedia",
         x="Years",
         fill="Entities") 
  }
  else{
    y <- y %>% filter(Country %in% names)
    y <- y%>%  mutate(year = as.Date(as.character(ISOdate(as.numeric(gsub('X', '', variable)),12,31)))) %>% 
    filter(! year< "2006-12-31") %>% mutate(val = as.double(value))
    ggplot(y, aes(x = year, y =val)) + geom_line(aes(color = Country))+ labs(title="Democracy Index", 
         subtitle="Between the years 2006-2022",
         caption="Source: Wikipedia",
         x="Years",
         fill="Entities") }
}
Countries_graphs(regions, c("World", "North America", "Asia and Australasia"))
```

YOUR ANALYSIS HERE

3.b.

```{r, cache=TRUE}
col <- colnames(countries)

max_value <- countries %>% select( colnames(countries)[which(col <= "X2022" & col >= "X2006")]) %>% apply( 1, max)
 min_value <- countries %>% select( colnames(countries)[which(col <= "X2022" & col >= "X2006")]) %>% apply( 1, min)
 
cntr <- countries %>% mutate(change = X2022 - X2006, max_value, min_value)


cntr1 <- cntr %>% filter(change >= 1.5)
clst1 <- cntr1$Country

cntr2 <- cntr %>% filter(change <= -1.5)
clst2 <- cntr2$Country

cntr3 <- cntr %>% filter(change >= 0.75 & change <= 1.5)
clst3 <- cntr3$Country

cntr4 <- cntr %>% filter(change <= -0.75 & change >= -1.5)
clst4 <- cntr4$Country

cntr5 <- cntr %>% mutate(min_ref = X2022 - min_value) %>% filter(change <= -0.75 & min_ref  >= 0.75)
clst5 <- cntr5$Country

cntr6 <- cntr %>% mutate(max_ref = X2022 - max_value) %>% filter(change >= 0.75 & max_ref  <= -0.75)
clst6 <- cntr6$Country

cntr7 <- cntr %>% mutate(Max_min = max_value -min_value) %>% filter(Max_min <= 0.5)
clst7 <- cntr7$Country

Country <- unique(c(clst1, clst2, clst3, clst4, clst5, clst6, clst7))
clst1_7 <- as.data.frame(Country)
cntr8 <- cntr %>% anti_join(clst1_7)
clst8 <- cntr8$Country

Countries_graphs(countries, clst1)
Countries_graphs(countries, clst2)
Countries_graphs(countries, clst3)
Countries_graphs(countries, clst4)
Countries_graphs(countries, clst5)
Countries_graphs(countries, clst6)
Countries_graphs(countries, clst7)
Countries_graphs(countries, clst8)

```

YOUR ANALYSIS HERE

4.  

```{r, cache=TRUE}
full_democracies <- seq(8,10,0.01)
flawed_democracies <- seq(6,7.99,0.01)
hybrid_regimes <- seq(4,5.99,0.01)
authoritarian_regimes <- seq(0,3.99,0.01)


```

YOUR ANALYSIS HERE

5.a.

```{r, cache=TRUE}
# YOUR CODE HERE
```

YOUR ANALYSIS HERE

5.b.

```{r, cache=TRUE}
# YOUR CODE HERE
```

YOUR ANALYSIS HERE

6.a.

```{r, cache=TRUE}
# YOUR CODE HERE
```

YOUR ANALYSIS HERE

6.b.

```{r, cache=TRUE}
# YOUR CODE HERE
```

YOUR ANALYSIS HERE

6.c.

```{r, cache=TRUE}
# YOUR CODE HERE
```

YOUR ANALYSIS HERE

7

```{r, cache=TRUE}
# YOUR CODE HERE
```

YOUR ANALYSIS HERE

8.a.

```{r, cache=TRUE}
# YOUR CODE HERE
```

YOUR ANALYSIS HERE

8.b.

```{r, cache=TRUE}
# YOUR CODE HERE
```

YOUR ANALYSIS HERE
